import{_ as o,Y as c,Z as i,$ as s,a0 as n,a1 as t,a2 as e,a3 as p,E as l}from"./framework-3d290349.js";const u={},r=p('<h1 id="使用kotlin协程的崩溃纪实-二" tabindex="-1"><a class="header-anchor" href="#使用kotlin协程的崩溃纪实-二" aria-hidden="true">#</a> 使用Kotlin协程的崩溃纪实(二)</h1><h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言" aria-hidden="true">#</a> 前言</h2><p>由于笔者对Kotlin协程缺乏深刻的理解以及充分的实践，导致在实际工作中使用Kotlin协程时遇到一些崩溃的问题。</p><p>那么本文主要记录遇到的这些崩溃问题，这是其中之二。</p><h2 id="背景" tabindex="-1"><a class="header-anchor" href="#背景" aria-hidden="true">#</a> 背景</h2><p>在Kotlin协程中如果使用下标访问集合数据，那么可能会抛出<code>IndexOutOfBoundsException</code>异常导致崩溃。</p>',6),d=p(`<h2 id="伪代码" tabindex="-1"><a class="header-anchor" href="#伪代码" aria-hidden="true">#</a> 伪代码</h2><p>下面是符合背景中描述的伪代码：</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> ml <span class="token operator">=</span> mutableListOf<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">0</span><span class="token operator">..</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ml<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">println</span><span class="token punctuation">(</span>ml<span class="token punctuation">)</span>

    <span class="token keyword">val</span> run <span class="token operator">=</span> RunSuspendKt<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">val</span> scope <span class="token operator">=</span> <span class="token function">CoroutineScope</span><span class="token punctuation">(</span>EmptyCoroutineContext<span class="token punctuation">)</span>
    scope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>
        <span class="token comment">// 协程A</span>
        <span class="token keyword">try</span>	<span class="token punctuation">{</span>
            <span class="token keyword">val</span> indexOf <span class="token operator">=</span> ml<span class="token punctuation">.</span><span class="token function">indexOfFirst</span> <span class="token punctuation">{</span> it <span class="token operator">==</span> <span class="token number">10</span> <span class="token punctuation">}</span>
            <span class="token function">log</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Element(10) indexOf: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">indexOf</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

            <span class="token function">suspendWork</span><span class="token punctuation">(</span><span class="token number">1_000L</span><span class="token punctuation">)</span>
            <span class="token keyword">val</span> value <span class="token operator">=</span> ml<span class="token punctuation">[</span>indexOf<span class="token punctuation">]</span>
            <span class="token function">log</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;IndexOf(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">indexOf</span></span><span class="token string">) element: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">value</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

            run<span class="token punctuation">.</span><span class="token function">resumeWith</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            run<span class="token punctuation">.</span><span class="token function">resumeWith</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">val</span> await <span class="token operator">=</span> RunSuspendKt<span class="token operator">&lt;</span>Boolean<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    await<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token number">500L</span><span class="token punctuation">)</span>

    scope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>
        <span class="token comment">// 协程B</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Remove element(10): </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">ml<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">val</span> code <span class="token operator">=</span> run<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Finish with [</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">code</span></span><span class="token string">]&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">suspendWork</span><span class="token punctuation">(</span>timeout<span class="token operator">:</span> Long<span class="token punctuation">)</span> <span class="token operator">=</span> suspendCoroutine<span class="token operator">&lt;</span>Boolean<span class="token operator">&gt;</span> <span class="token punctuation">{</span> continuation <span class="token operator">-&gt;</span>
    thread <span class="token punctuation">{</span>
        Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span>
        continuation<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span>Random<span class="token punctuation">.</span><span class="token function">nextBoolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">val</span> DF <span class="token operator">=</span> <span class="token function">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;HH:mm:ss.SSS&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">log</span><span class="token punctuation">(</span>any<span class="token operator">:</span> Any<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">DF<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token function">Date</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">any</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的伪代码大致的逻辑如下：</p><ol><li><p>创建一个可变列表<code>ml</code>并添加**[0, 10]**这11条数据，</p></li><li><p>创建一个<code>RunSuspend</code>的实例<code>run</code>，用于主线程等待协程执行完毕，否则主线程退出，协程无法执行完毕，</p></li><li><p>创建一个协程作用域<code>scope，</code>启动一个<strong>协程A</strong>，</p><ol><li>在协程中首先获取<code>Element(10)</code>的下标(<code>indexOf</code>)，</li><li>然后调用<code>suspendWork</code>挂起函数模拟执行耗时任务，</li><li><code>suspendWork</code>挂起函数执行完毕后，再通过第一步获取的下标(<code>indexOf</code>)获取对应的<code>Element</code>，</li><li>协程体执行完毕后或抛出异常时调用<code>run.resumeWith</code>通知主线程协程执行完毕并停止阻塞主线程，</li></ol></li><li><p>再创建一个<code>RunSuspend</code>的实例<code>await</code>，用于阻塞主线程<strong>500毫秒</strong>，然后启动一个新的<strong>协程B</strong>移除<code>ml</code>可变列表中的<code>Element(10)</code>，</p></li><li><p>调用<code>run.await</code>阻塞主线程并等待<strong>协程A</strong>执行完毕。</p></li></ol><p>伪代码执行的期望结果如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span><span class="token number">0</span>, <span class="token number">1</span>, <span class="token number">2</span>, <span class="token number">3</span>, <span class="token number">4</span>, <span class="token number">5</span>, <span class="token number">6</span>, <span class="token number">7</span>, <span class="token number">8</span>, <span class="token number">9</span>, <span class="token number">10</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">22</span>:00:37.575 DefaultDispatcher-worker-1<span class="token punctuation">]</span>: Element<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> indexOf: <span class="token number">10</span>
<span class="token punctuation">[</span><span class="token number">22</span>:00:38.080 DefaultDispatcher-worker-1<span class="token punctuation">]</span>: Remove element<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>: <span class="token boolean">true</span>
<span class="token punctuation">[</span><span class="token number">22</span>:00:38.581 DefaultDispatcher-worker-1<span class="token punctuation">]</span>: IndexOf<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> element: <span class="token number">10</span>
<span class="token punctuation">[</span><span class="token number">22</span>:00:38.581 main<span class="token punctuation">]</span>: Finish with <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>笔者期望伪代码可以正常的执行完毕。</p><p>但是，实际上伪代码执行的结果如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span><span class="token number">0</span>, <span class="token number">1</span>, <span class="token number">2</span>, <span class="token number">3</span>, <span class="token number">4</span>, <span class="token number">5</span>, <span class="token number">6</span>, <span class="token number">7</span>, <span class="token number">8</span>, <span class="token number">9</span>, <span class="token number">10</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">22</span>:01:37.814 DefaultDispatcher-worker-1<span class="token punctuation">]</span>: Element<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> indexOf: <span class="token number">10</span>
<span class="token punctuation">[</span><span class="token number">22</span>:01:38.330 DefaultDispatcher-worker-1<span class="token punctuation">]</span>: Remove element<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>: <span class="token boolean">true</span>
java.lang.IndexOutOfBoundsException: Index: <span class="token number">10</span>, Size: <span class="token number">10</span>
	at java.util.ArrayList.rangeCheck<span class="token punctuation">(</span>ArrayList.java:657<span class="token punctuation">)</span>
	at java.util.ArrayList.get<span class="token punctuation">(</span>ArrayList.java:433<span class="token punctuation">)</span>
	at CoroutinesCrashKt<span class="token variable">$main</span><span class="token variable">$1</span>.invokeSuspend<span class="token punctuation">(</span>CoroutinesCrash.kt:31<span class="token punctuation">)</span>
	at kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith<span class="token punctuation">(</span>ContinuationImpl.kt:33<span class="token punctuation">)</span>
	at kotlinx.coroutines.DispatchedTask.run<span class="token punctuation">(</span>DispatchedTask.kt:106<span class="token punctuation">)</span>
	at kotlinx.coroutines.scheduling.CoroutineScheduler.runSafely<span class="token punctuation">(</span>CoroutineScheduler.kt:571<span class="token punctuation">)</span>
	at kotlinx.coroutines.scheduling.CoroutineScheduler<span class="token variable">$Worker</span>.executeTask<span class="token punctuation">(</span>CoroutineScheduler.kt:750<span class="token punctuation">)</span>
	at kotlinx.coroutines.scheduling.CoroutineScheduler<span class="token variable">$Worker</span>.runWorker<span class="token punctuation">(</span>CoroutineScheduler.kt:678<span class="token punctuation">)</span>
	at kotlinx.coroutines.scheduling.CoroutineScheduler<span class="token variable">$Worker</span>.run<span class="token punctuation">(</span>CoroutineScheduler.kt:665<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">22</span>:01:38.830 main<span class="token punctuation">]</span>: Finish with <span class="token punctuation">[</span>-1<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行结果分析：</p><ol><li><strong>协程A</strong>中仅输出了第一步获取到<code>Element(10)</code>下标(<code>indexOf</code>)的日志，</li><li><code>await</code>实例阻塞主线程<strong>500毫秒</strong>后，我们在启动的<strong>协程B</strong>中移除<code>ml</code>可变列表中的<code>Element(10)</code>，并输出日志移除成功：<code>true</code>，</li><li>回到<strong>协程A</strong>，等到协程体中的<code>suspendWork</code>挂起函数执行完毕后，想通过下标(<code>indexOf</code>)获取对应的<code>Element</code>时，抛出异常，</li></ol><h2 id="分析" tabindex="-1"><a class="header-anchor" href="#分析" aria-hidden="true">#</a> 分析</h2><p>为什么执行结果会与我们期望的结果不同呢？接下来我们分析下原因。</p><p>首先我们再仔细观察下<strong>协程A</strong>中的代码：</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code>scope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">val</span> indexOf <span class="token operator">=</span> ml<span class="token punctuation">.</span><span class="token function">indexOfFirst</span> <span class="token punctuation">{</span> it <span class="token operator">==</span> <span class="token number">10</span> <span class="token punctuation">}</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Element(10) indexOf: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">indexOf</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

        <span class="token function">suspendWork</span><span class="token punctuation">(</span><span class="token number">1_000L</span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> value <span class="token operator">=</span> ml<span class="token punctuation">[</span>indexOf<span class="token punctuation">]</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;IndexOf(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">indexOf</span></span><span class="token string">) element: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">value</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

        run<span class="token punctuation">.</span><span class="token function">resumeWith</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        run<span class="token punctuation">.</span><span class="token function">resumeWith</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>按照笔者的想法，<strong>协程A</strong>中协程体的执行逻辑如下：</p><ol><li>协程体是在同一个线程中执行，</li><li>协程体是同步且顺序执行的，</li></ol><p>可以简单理解协程体的执行是线程安全的。</p><h3 id="真的线程安全么" tabindex="-1"><a class="header-anchor" href="#真的线程安全么" aria-hidden="true">#</a> 真的线程安全么？</h3><p>针对第一点，目前的<code>scope</code>没有指定运行的线程，那么协程默认是在<code>Default</code>线程池中执行，同时循环体的每次执行都会触发两次线程切换：</p><ol><li>其一是从<code>launch</code>协程体执行的线程切换至<code>suspendWork</code>挂起函数执行的线程，</li><li>其二是<code>suspendWork</code>挂起函数执行完毕后，从<code>suspendWork</code>挂断函数执行线程切换回<code>launch</code>协程体执行的线程，</li></ol><p>而<code>launch</code>协程体执行的线程由<code>Default</code>线程池分配，线程池分配线程存在不固定性，所以协程体在同一个线程中执行不能成立，自然不能称为是线程安全的。</p><h3 id="为什么会有这样的想法呢" tabindex="-1"><a class="header-anchor" href="#为什么会有这样的想法呢" aria-hidden="true">#</a> 为什么会有这样的想法呢？</h3><p>正如前言中所说，笔者对协程缺乏深刻的理解以及充分的实践，而协程的一大特点是：使用「同步代码」写出异步程序。</p><p>其实笔者就是被「同步代码」这一表象所“欺骗”，这也是笔者对协程缺乏深刻理解的佐证。</p><p>使用「同步代码」写出异步程序，对程序猿来说这是多么美好的事情，但是如果对协程理解的不够深入，不清楚它背后的逻辑，那么很容易就像笔者一样被它简单的表象所“欺骗”。</p><p>针对第二点，协程的特点是使用「同步代码」写出异步程序，在协程体中调用了挂起函数，那么协程体中的逻辑必然是异步程序，所以第二点也不成立。</p><h3 id="异常原因" tabindex="-1"><a class="header-anchor" href="#异常原因" aria-hidden="true">#</a> 异常原因</h3><p>本文记录的崩溃原因比较好分析：<strong>协程A</strong>第一步中获取的下标(<code>idnexOf</code>)，在经过<strong>协程B</strong>移除<code>Element(10)</code>之后就变成了一个过期的下标(<code>indexOf</code>)，等到<strong>协程A</strong>中<code>suspendWork</code>挂起函数执行完毕，想通过过期的下标(<code>indexOf</code>)获取对应的<code>Element</code>时，必然会抛出<code>IndexOutOfBoundsException</code>异常。</p><h3 id="如何修复" tabindex="-1"><a class="header-anchor" href="#如何修复" aria-hidden="true">#</a> 如何修复？</h3><p>修复方案有多种，比如：</p><ol><li>在<strong>协程A</strong>第一步获取到下标(<code>indexOf</code>)之后，<code>suspendWork</code>挂起函数之前，通过第一步获取到的下标(<code>indexOf</code>)获取对应的<code>Element</code>，</li><li>在<strong>协程A</strong>中的<code>suspendWork</code>挂起函数执行完毕后，需判断下标(<code>indexOf</code>)是否过期，</li><li>使用加锁的方式，<strong>协程A</strong>操作<code>ml</code>集合时不允许其他协程对<code>ml</code>集合进行更新，</li><li>其他方式，</li></ol><p>具体选择哪种修复方案，这里可以根据业务场景的不同而选择不同的修复方案。</p><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>本文记录了笔者在使用Kotlin协程过程中遇到的下标过期导致的崩溃问题，通过伪代码笔者复现了崩溃问题，并分析了问题产生的原因以及给出一些修复方案供选择参考。</p>`,36),k=s("strong",null,"使用「同步代码」写出异步程序",-1),m=s("p",null,"其中最重要的是发现自身的不足，发现自身的不足也是一种进步。",-1),v=s("blockquote",null,[s("p",null,"纸上得来终觉浅，绝知此事要躬行。")],-1);function b(h,f){const a=l("RouterLink");return c(),i("div",null,[r,s("blockquote",null,[s("p",null,[n("本文记录的崩溃情况与"),t(a,{to:"/SourceCodeAnalysis/KotlinCoroutines/00-for-in-crash.html"},{default:e(()=>[n("第一篇")]),_:1}),n("中的属于同一种类型，只是触发的代码逻辑和业务逻辑略有不同，所以本文的风格与第一篇雷同。")])]),d,s("p",null,[n("本文与"),t(a,{to:"/SourceCodeAnalysis/KotlinCoroutines/00-for-in-crash.html"},{default:e(()=>[n("第一篇")]),_:1}),n("中记录的情况，笔者都是被协程特点："),k,n('所"欺骗"，所以在协程体中调用其他的挂起函数时，挂起函数的前后代码最好不要有关联性，最好保持独立性，否则可能会发生意想不到的情况，归根结底还是笔者对协程缺乏深刻的理解以及充分的实践。')]),m,v])}const x=o(u,[["render",b],["__file","01-index-out-of-bounds-crash.html.vue"]]);export{x as default};
