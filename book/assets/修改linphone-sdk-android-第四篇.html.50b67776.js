import{_ as n}from"./plugin-vue_export-helper.21dcd24c.js";import{o as s,c as a,e as t}from"./app.97323df6.js";const o={},p=t(`<h1 id="\u4FEE\u6539linphone-sdk-android-\u7B2C\u56DB\u7BC7" tabindex="-1"><a class="header-anchor" href="#\u4FEE\u6539linphone-sdk-android-\u7B2C\u56DB\u7BC7" aria-hidden="true">#</a> \u4FEE\u6539linphone-sdk-android-\u7B2C\u56DB\u7BC7</h1><h2 id="\u80CC\u666F" tabindex="-1"><a class="header-anchor" href="#\u80CC\u666F" aria-hidden="true">#</a> \u80CC\u666F</h2><p>\u5728\u4F7F\u7528linphone-sdk-android\u8FC7\u7A0B\u4E2D\uFF0C\u53D1\u73B0\u5F53\u6709\u4E00\u8D77\u547C\u53EB\u5728\u901A\u8BDD\u4E2D\u65F6\uFF0C\u53C8\u6536\u5230\u4E00\u8D77\u547C\u53EB\uFF0C\u4F1A\u83AB\u540D\u5176\u5999\u7684\u64AD\u62A5\u632F\u94C3\u58F0\u97F3\uFF0C\u95EE\u9898\u662F\u5DF2\u7ECF\u8C03\u7528linphone-sdk-android\u63D0\u4F9B\u7684\u63A5\u53E3\u5173\u95ED\u4E86\u632F\u94C3\u58F0\u97F3</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u5173\u95EDRing</span>
mCore<span class="token punctuation">.</span><span class="token function">setRing</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mCore<span class="token punctuation">.</span><span class="token function">setRingback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mCore<span class="token punctuation">.</span><span class="token function">setRemoteRingbackTone</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mCore<span class="token punctuation">.</span><span class="token function">setNativeRingingEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mCore<span class="token punctuation">.</span><span class="token function">setRingDuringIncomingEarlyMedia</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mCore<span class="token punctuation">.</span><span class="token function">setVibrationOnIncomingCallEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u5173\u95EDCallErrorTone</span>
<span class="token class-name">Reason</span><span class="token punctuation">[</span><span class="token punctuation">]</span> reasons <span class="token operator">=</span> <span class="token class-name">Reason</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Reason</span> reason <span class="token operator">:</span> reasons<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mCore<span class="token punctuation">.</span><span class="token function">setCallErrorTone</span><span class="token punctuation">(</span>reason<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u5173\u95EDToneId</span>
<span class="token class-name">ToneID</span><span class="token punctuation">[</span><span class="token punctuation">]</span> toneIds <span class="token operator">=</span> <span class="token class-name">ToneID</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ToneID</span> toneId <span class="token operator">:</span> toneIds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mCore<span class="token punctuation">.</span><span class="token function">setTone</span><span class="token punctuation">(</span>toneId<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#\u5206\u6790" aria-hidden="true">#</a> \u5206\u6790</h2><p>\u67E5\u770BLogcat\u8F93\u51FA\u7684\u65E5\u5FD7\uFF0C\u5206\u6790\u53D1\u73B0\u6709<code>ToneManager</code>\u3001<code>doStartRingtone</code>\u7B49\u5173\u952E\u8BCD</p><div class="language-logcat ext-logcat line-numbers-mode"><pre class="language-logcat"><code>13056-13056/com.guodong.android.linphone I/liblinphone: [ToneManager] [0x934e70ac] state changed : [None, LinphoneCallIncomingReceived]
13056-13056/com.guodong.android.linphone I/liblinphone: [ToneManager] add new session [0x934e70ac]
13056-13056/com.guodong.android.linphone I/liblinphone: [ToneManager] doStopToneToPlaySomethingElse
13056-13056/com.guodong.android.linphone I/liblinphone: [ToneManager] doStartRingtone
13056-13056/com.guodong.android.linphone I/liblinphone: [ToneManager] doStartNamedTone [2]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6253\u5F00IDE\u53BB\u6E90\u7801\u4E2D\u641C\u7D22\u4E00\u756A\uFF0C\u53D1\u73B0<code>tone-manager.cpp</code>\uFF0C\u5728\u5176\u4E2D\u627E\u5230<code>doStopToneToPlaySomethingElse</code>\u3001<code>doStartRingtone</code>\u3001<code>doStartNamedTone</code>\u65B9\u6CD5\uFF0C\u4E0ELogcat\u65E5\u5FD7\u8F93\u51FA\u543B\u5408</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token class-name">ToneManager</span><span class="token double-colon punctuation">::</span><span class="token function">doStopToneToPlaySomethingElse</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>CallSession<span class="token operator">&gt;</span> <span class="token operator">&amp;</span>session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">lInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;[ToneManager] &quot;</span> <span class="token operator">&lt;&lt;</span> <span class="token constant">__func__</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isAnotherSessionInState</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> State<span class="token double-colon punctuation">::</span>Tone<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">doStopTone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">ToneManager</span><span class="token double-colon punctuation">::</span><span class="token function">doStartRingtone</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>CallSession<span class="token operator">&gt;</span> <span class="token operator">&amp;</span>session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">lInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;[ToneManager] &quot;</span> <span class="token operator">&lt;&lt;</span> <span class="token constant">__func__</span><span class="token punctuation">;</span>
	LinphoneCore <span class="token operator">*</span>lc <span class="token operator">=</span> <span class="token function">getCore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getCCore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u5982\u679C\u6709\u4E00\u4E2A\u6B63\u5728\u901A\u8BDD\u7684\u547C\u53EB\u5C31\u8C03\u7528\`doStartNamedTone\`</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isAnotherSessionInState</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> State<span class="token double-colon punctuation">::</span>Call<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">/* play a tone within the context of the current call */</span>
		<span class="token function">doStartNamedTone</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> LinphoneToneCallWaiting<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		MSSndCard <span class="token operator">*</span>ringcard <span class="token operator">=</span> lc<span class="token operator">-&gt;</span>sound_conf<span class="token punctuation">.</span>lsd_card <span class="token operator">?</span> lc<span class="token operator">-&gt;</span>sound_conf<span class="token punctuation">.</span>lsd_card <span class="token operator">:</span> lc<span class="token operator">-&gt;</span>sound_conf<span class="token punctuation">.</span>ring_sndcard<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>ringcard <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">linphone_core_is_native_ringing_enabled</span><span class="token punctuation">(</span>lc<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">linphone_core_callkit_enabled</span><span class="token punctuation">(</span>lc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">ms_snd_card_set_stream_type</span><span class="token punctuation">(</span>ringcard<span class="token punctuation">,</span> MS_SND_CARD_STREAM_RING<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">linphone_ringtoneplayer_start</span><span class="token punctuation">(</span>lc<span class="token operator">-&gt;</span>factory<span class="token punctuation">,</span> lc<span class="token operator">-&gt;</span>ringtoneplayer<span class="token punctuation">,</span> ringcard<span class="token punctuation">,</span> lc<span class="token operator">-&gt;</span>sound_conf<span class="token punctuation">.</span>local_ring<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
				<span class="token function">ms_message</span><span class="token punctuation">(</span><span class="token string">&quot;Callkit is enabled, not playing ringtone.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">ToneManager</span><span class="token double-colon punctuation">::</span><span class="token function">doStartNamedTone</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>CallSession<span class="token operator">&gt;</span> <span class="token operator">&amp;</span>session<span class="token punctuation">,</span> LinphoneToneID toneId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">lInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;[ToneManager] &quot;</span> <span class="token operator">&lt;&lt;</span> <span class="token constant">__func__</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot; [&quot;</span> <span class="token operator">&lt;&lt;</span> <span class="token class-name">Utils</span><span class="token double-colon punctuation">::</span><span class="token function">toString</span><span class="token punctuation">(</span>toneId<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
	LinphoneToneDescription <span class="token operator">*</span>tone <span class="token operator">=</span> <span class="token function">getToneFromId</span><span class="token punctuation">(</span>toneId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u5728Java\u4E2D\u5DF2\u5C06audiofile\u7F6E\u4E3A&quot;&quot;\uFF0C\u6240\u4EE5\u4F1A\u8D70else\u5206\u652F</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>tone <span class="token operator">&amp;&amp;</span> tone<span class="token operator">-&gt;</span>audiofile<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">playFile</span><span class="token punctuation">(</span>tone<span class="token operator">-&gt;</span>audiofile<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u6B64\u5904\u751F\u6210\u632F\u94C3\u58F0\u97F3</span>
		MSDtmfGenCustomTone dtmfTone <span class="token operator">=</span> <span class="token function">generateToneFromId</span><span class="token punctuation">(</span>toneId<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">playTone</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> dtmfTone<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u597D\u7684\uFF0C\u73B0\u5728\u5148\u627E\u5230\u8C03\u7528<code>doStopToneToPlaySomethingElse</code>\u7684\u65B9\u6CD5\uFF0C\u5728IDE\u4E2D\u67E5\u627E\uFF0C\u53D1\u73B0<code>startRingtone</code>\u65B9\u6CD5</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token class-name">ToneManager</span><span class="token double-colon punctuation">::</span><span class="token function">printDebugInfo</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>CallSession<span class="token operator">&gt;</span> <span class="token operator">&amp;</span>session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">auto</span> callState <span class="token operator">=</span> session<span class="token operator">-&gt;</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> toneState <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">lInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;[ToneManager] [&quot;</span> <span class="token operator">&lt;&lt;</span> session <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;] state changed : [&quot;</span> <span class="token operator">&lt;&lt;</span> <span class="token function">stateToString</span><span class="token punctuation">(</span>toneState<span class="token punctuation">)</span>  <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">&lt;&lt;</span> <span class="token class-name">Utils</span><span class="token double-colon punctuation">::</span><span class="token function">toString</span><span class="token punctuation">(</span>callState<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">ToneManager</span><span class="token double-colon punctuation">::</span><span class="token function">startRingtone</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>CallSession<span class="token operator">&gt;</span> <span class="token operator">&amp;</span>session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">printDebugInfo</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u5BF9\u5E94Logcat\u7B2C\u4E00\u884C\u8F93\u51FA\u65E5\u5FD7</span>
	<span class="token function">setState</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> State<span class="token double-colon punctuation">::</span>Ringtone<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u5BF9\u5E94Logcat\u7B2C\u4E8C\u884C\u8F93\u51FA\u65E5\u5FD7</span>
    <span class="token comment">// \u5982\u679C\u53E6\u5916\u4E00\u4E2A\u547C\u53EB\u4E0D\u5728Ringtone\u4E14\u4E0D\u5728Ringback\u72B6\u6001</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isAnotherSessionInState</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> State<span class="token double-colon punctuation">::</span>Ringtone<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isAnotherSessionInState</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> State<span class="token double-colon punctuation">::</span>Ringback<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">doStopToneToPlaySomethingElse</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">doStartRingtone</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mStats<span class="token operator">-&gt;</span>number_of_startRingtone<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u67E5\u770B<code>ToneManager::startRingtone</code>\u4E0B\u9762\u7684<code>startErrorTone</code>\u65B9\u6CD5\uFF0C\u53D1\u73B0\u6B64\u65B9\u6CD5\u662F\u8C03\u7528<code>linphone_core_tone_indications_enabled</code>\u5224\u65AD\u662F\u5426\u53EF\u4EE5\u64AD\u62A5Tone\uFF0C\u731C\u60F3\u53EF\u4EE5\u5728<code>startRingtone</code>\u65B9\u6CD5\u4E2D\u4E5F\u589E\u52A0\u6B64\u5224\u65AD\u903B\u8F91</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token class-name">ToneManager</span><span class="token double-colon punctuation">::</span><span class="token function">startErrorTone</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>CallSession<span class="token operator">&gt;</span> <span class="token operator">&amp;</span>session<span class="token punctuation">,</span> LinphoneReason reason<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	LinphoneCore <span class="token operator">*</span>lc <span class="token operator">=</span> <span class="token function">getCore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getCCore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u6B64\u5904\u5224\u65AD\u662F\u5426\u53EF\u4EE5\u64AD\u62A5Tone</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">linphone_core_tone_indications_enabled</span><span class="token punctuation">(</span>lc<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printDebugInfo</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">doStopToneToPlaySomethingElse</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">doStartErrorTone</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mStats<span class="token operator">-&gt;</span>number_of_startErrorTone<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0D\u8FC7\u9700\u8981\u5148\u4E86\u89E3\u4E0B<code>linphone_core_tone_indications_enabled</code>\u65B9\u6CD5\u7684\u5B9E\u73B0\uFF0C\u6B64\u65B9\u6CD5\u4F4D\u4E8E<code>msic.c</code>\u4E2D\uFF0C\u65B9\u6CD5\u5185\u90E8\u4ECE<code>linphone_config</code>\u4E2D\u8BFB\u53D6<code>sound</code>section\u4E0B<code>tone_indications</code>key\u7684\u503C\u8F6C\u6362\u4E3A<code>bool_t</code>\u7C7B\u578B\uFF0C\u5927\u4E8E0\u4E3ATure\uFF0C\u5C0F\u4E8E\u7B49\u4E8E0\u4E3AFlase\uFF0C\u5176\u4E2D<code>linphone_config</code>\u53EF\u4EE5\u4ECEJava\u5C42\u914D\u7F6E</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code>bool_t <span class="token function">linphone_core_tone_indications_enabled</span><span class="token punctuation">(</span>LinphoneCore<span class="token operator">*</span>lc<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token function">linphone_config_get_int</span><span class="token punctuation">(</span>lc<span class="token operator">-&gt;</span>config<span class="token punctuation">,</span><span class="token string">&quot;sound&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;tone_indications&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u597D\u7684\uFF0C\u95EE\u9898\u5206\u6790\u5B8C\u6BD5\uFF0C\u53EF\u4EE5\u5728<code>startRingtone</code>\u65B9\u6CD5\u4E2D\u4E5F\u589E\u52A0\u6B64\u5224\u65AD\u903B\u8F91\u4E86</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token class-name">ToneManager</span><span class="token double-colon punctuation">::</span><span class="token function">startRingtone</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>CallSession<span class="token operator">&gt;</span> <span class="token operator">&amp;</span>session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">printDebugInfo</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">setState</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> State<span class="token double-colon punctuation">::</span>Ringtone<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// modified by guodongAndroid on 2022/04/24 \u4FEE\u6539\u6709\u6B63\u5728\u901A\u8BDD\u7684\u547C\u53EB\u65F6\uFF0C\u53C8\u6536\u5230\u4E00\u8D77\u547C\u53EB\u64AD\u62A5Ringtone\u95EE\u9898</span>
	<span class="token comment">// \u589E\u52A0tone_indications\u662F\u5426\u5F00\u542F\u5224\u65AD</span>
	LinphoneCore <span class="token operator">*</span>lc <span class="token operator">=</span> <span class="token function">getCore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getCCore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">linphone_core_tone_indications_enabled</span><span class="token punctuation">(</span>lc<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isAnotherSessionInState</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> State<span class="token double-colon punctuation">::</span>Ringtone<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isAnotherSessionInState</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> State<span class="token double-colon punctuation">::</span>Ringback<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">doStopToneToPlaySomethingElse</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">doStartRingtone</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mStats<span class="token operator">-&gt;</span>number_of_startRingtone<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4FDD\u5B58\u91CD\u65B0\u7F16\u8BD1\uFF0C\u7B49\u5F85\u7F16\u8BD1\u5B8C\u6210\u62F7\u8D1D\u81F3AS\u4E2D\uFF0C\u73B0\u5728\u53EA\u9700\u5728Java\u5C42\u521D\u59CB\u5316\u65F6\u914D\u7F6EConfig\uFF0C\u4FEE\u6539<code>tone_indications</code>\u7684\u503C\u5373\u53EF</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// modified by guodongAndroid on 2022/04/24 \u4FEE\u6539\u6709\u6B63\u5728\u901A\u8BDD\u7684\u547C\u53EB\u65F6\uFF0C\u53C8\u6536\u5230\u4E00\u8D77\u547C\u53EB\u64AD\u62A5Ringtone\u95EE\u9898</span>
<span class="token comment">// \u5173\u95EDToneIndications</span>
mCore<span class="token punctuation">.</span><span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token string">&quot;sound&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tone_indications&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>happy~</p>`,20),e=[p];function c(l,i){return s(),a("div",null,e)}var r=n(o,[["render",c],["__file","\u4FEE\u6539linphone-sdk-android-\u7B2C\u56DB\u7BC7.html.vue"]]);export{r as default};
