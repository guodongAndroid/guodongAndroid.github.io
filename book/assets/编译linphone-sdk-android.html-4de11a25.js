import{_ as d,Y as s,Z as l,$ as e,a0 as n,a1 as i,a3 as r,E as t}from"./framework-3d290349.js";const o={},c=r(`<h1 id="编译linphone-sdk-android" tabindex="-1"><a class="header-anchor" href="#编译linphone-sdk-android" aria-hidden="true">#</a> 编译linphone-sdk-android</h1><h2 id="编译环境" tabindex="-1"><a class="header-anchor" href="#编译环境" aria-hidden="true">#</a> 编译环境</h2><p>系统 Ubuntu 20.04.4 LTS 2核4G 50G存储 i5-8250U 1.60Ghz</p><p>Android SDK r24.4.1</p><p>Android NDK r18b</p><p>Linphone SDK Release 4.5</p><p>CMake 3.16.3</p><p>Python 3.8.10</p><p>Git 2.15.1</p><p>Java 1.8.0_312</p><h2 id="android环境准备" tabindex="-1"><a class="header-anchor" href="#android环境准备" aria-hidden="true">#</a> Android环境准备</h2><p>安装 Android SDK NDK cmdline-tools</p><p>NDK：https://developer.android.google.cn/ndk/downloads?hl=en</p><p>SDK：https://links.jianshu.com/go?to=http%3A%2F%2Fdl.google.com%2Fandroid%2Fandroid-sdk_r24.4.1-linux.tgz</p><p>Cmdline：https://dl.google.com/android/repository/commandlinetools-linux-6200805_latest.zip</p><p>三个压缩包下载之后，将NDK和SDK解压，commandlinetools-linux-6200805_latest.zip 解压后将解压出来的tools文件夹放在sdk根目录的cmdline-tools文件夹里边，如果没有cmdline-tools文件夹，就手动创建一个。放好文件之后需要配置环境变量,在~/ .profile文件下末尾添加一下内容，路径换成你自己的文件路径</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>export JAVA_HOME=你自己的路径
export PATH=$JAVA_HOME:$PATH

export ANDROID_HOME=你自己的路径/android-sdk-linux
export PATH=$ANDROID_HOME/tools:$ANDROID_HOME/platform-tools:$ANDROID_HOME/cmdline-tools/tools/bin:$PATH

export NDK_HOME=你自己的路径/android-ndk-r18b
export PATH=$NDK_HOME:$PATH
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ubuntu环境准备" tabindex="-1"><a class="header-anchor" href="#ubuntu环境准备" aria-hidden="true">#</a> Ubuntu环境准备</h2><h3 id="安装cmake" tabindex="-1"><a class="header-anchor" href="#安装cmake" aria-hidden="true">#</a> 安装cmake</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ sudo apt-get install cmake
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="安装git" tabindex="-1"><a class="header-anchor" href="#安装git" aria-hidden="true">#</a> 安装git</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ sudo apt-get install git
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="安装java" tabindex="-1"><a class="header-anchor" href="#安装java" aria-hidden="true">#</a> 安装java</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ sudo apt-get install openjdk-8-jdk
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="安装yasm" tabindex="-1"><a class="header-anchor" href="#安装yasm" aria-hidden="true">#</a> 安装yasm</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ sudo apt-get install yasm
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="安装nasm" tabindex="-1"><a class="header-anchor" href="#安装nasm" aria-hidden="true">#</a> 安装nasm</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ sudo apt-get install nasm
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="安装doxygen" tabindex="-1"><a class="header-anchor" href="#安装doxygen" aria-hidden="true">#</a> 安装doxygen</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ sudo apt-get install doxygen
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="安装clang" tabindex="-1"><a class="header-anchor" href="#安装clang" aria-hidden="true">#</a> 安装clang</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ sudo apt-get install clang
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="安装g-multilib" tabindex="-1"><a class="header-anchor" href="#安装g-multilib" aria-hidden="true">#</a> 安装g++-multilib</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ sudo apt-get install g++-multilib
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="安装pip" tabindex="-1"><a class="header-anchor" href="#安装pip" aria-hidden="true">#</a> 安装pip</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ sudo apt-get install python3-pip
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="配置pip源" tabindex="-1"><a class="header-anchor" href="#配置pip源" aria-hidden="true">#</a> 配置pip源</h3><p>编辑<code>~/.pip/pip.conf</code>，若没有此文件自行创建，填写以下内容：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[global]
index-url = https://pypi.tuna.tsinghua.edu.cn/simple
[install]
trusted-host = https://pypi.tuna.tsinghua.edu.cn
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="安装pystache" tabindex="-1"><a class="header-anchor" href="#安装pystache" aria-hidden="true">#</a> 安装pystache</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pip3 install pystache
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="安装six" tabindex="-1"><a class="header-anchor" href="#安装six" aria-hidden="true">#</a> 安装six</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pip3 install six
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="android-sdk-协议授予" tabindex="-1"><a class="header-anchor" href="#android-sdk-协议授予" aria-hidden="true">#</a> Android SDK 协议授予</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yes | sdkmanager --licenses &amp;&amp; sdkmanager --update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>编译前环境基本准备完毕。</p><h2 id="编译linphone-sdk" tabindex="-1"><a class="header-anchor" href="#编译linphone-sdk" aria-hidden="true">#</a> 编译Linphone SDK</h2><h3 id="下载源码" tabindex="-1"><a class="header-anchor" href="#下载源码" aria-hidden="true">#</a> 下载源码</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ git clone -b release/4.5 https://gitlab.linphone.org/BC/public/linphone-sdk.git --recursive
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>注意点：</p><ol><li>根据个人网络情况，可能需要挂VPN</li><li>clone需要加<code>--recursive</code>，因为linphone-sdk使用git submodule功能搭建，引用了十几个module，<code>--recursive</code>会在clone的时候把引用的module也下载下来</li></ol><p>处理下文件可执行权限：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ chmod u+x linphone-sdk/cmake/Android/gradlew
$ chmod u+x linphone-sdk/external/libvpx/configure
$ chmod u+x linphone-sdk/cmake/dummy.sh
$ chmod u+x linphone-sdk/external/libvpx/build/make/*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="开始编译" tabindex="-1"><a class="header-anchor" href="#开始编译" aria-hidden="true">#</a> 开始编译</h3><p>到这里一切准备就绪，可以开始编译了，创建build文件夹，编译过程产物都在build文件夹里</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ cd linphone-sdk
$ mkdir build &amp;&amp; cd build
$ cmake -DCMAKE_VERBOSE_MAKEFILE=ON -DLINPHONESDK_PLATFORM=Android -DLINPHONESDK_ANDROID_ARCHS=arm64,armv7,x86,x86_64 -DENABLE_G729=YES ..
$ cmake --build . --parallel 8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>目前是指定编译目标平台是Android，编译目标CPU架构是arm64/armv7,x86,x86_64，并开启G729音频编解码，开启8个线程编译，在目前编译环境下，整编一次耗时大约一个半小时，后续增量编译会快不少</p><p>不需要x86,x86_64架构的，可以删除。</p><p>目前编译过程中没有报错，happy~~~</p><p>编译完成后的产物在以下目录：</p><ul><li>.so：build/libs/</li><li>aar：build/linphone-sdk/bin/outputs/aar/</li><li>maven：build/maven_repository</li></ul><p>最后创建一个编译脚本<code>build.sh</code>，把上面的编译命令复制到文件里保存，每次编译时执行编译脚本即可<code>./build.sh</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#! /bin/bash</span>

cmake <span class="token parameter variable">-DCMAKE_VERBOSE_MAKEFILE</span><span class="token operator">=</span>ON <span class="token parameter variable">-DLINPHONESDK_PLATFORM</span><span class="token operator">=</span>Android <span class="token parameter variable">-DLINPHONESDK_ANDROID_ARCHS</span><span class="token operator">=</span>arm64,armv7,x86,x86_64 <span class="token parameter variable">-DENABLE_G729</span><span class="token operator">=</span>YES <span class="token punctuation">..</span>
cmake <span class="token parameter variable">--build</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">--parallel</span> <span class="token number">8</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="参考文档" tabindex="-1"><a class="header-anchor" href="#参考文档" aria-hidden="true">#</a> 参考文档</h2>`,64),p={href:"https://gitlab.linphone.org/BC/public/linphone-sdk",target:"_blank",rel:"noopener noreferrer"},u={href:"https://www.jianshu.com/p/942f989eaac7",target:"_blank",rel:"noopener noreferrer"},h={href:"https://www.codenong.com/cs106423576/",target:"_blank",rel:"noopener noreferrer"};function m(v,b){const a=t("ExternalLinkIcon");return s(),l("div",null,[c,e("p",null,[e("a",p,[n("官方文档"),i(a)])]),e("p",null,[e("a",u,[n("LinPhone Android SDK 编译过程"),i(a)])]),e("p",null,[e("a",h,[n("编译linphone Android"),i(a)])])])}const g=d(o,[["render",m],["__file","编译linphone-sdk-android.html.vue"]]);export{g as default};
